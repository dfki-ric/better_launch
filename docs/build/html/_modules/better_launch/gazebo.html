

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>better_launch.gazebo &mdash; better_launch 0.9.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
    <link rel="shortcut icon" href="../../_static/logo.svg"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=9dc39874"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            better_launch
              <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../better_launch_custom.html">better_launch package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">better_launch</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">better_launch.gazebo</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for better_launch.gazebo</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Additional functions for working with Gazebo, taking inspiration from simple_launch.&quot;&quot;&quot;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;get_gazebo_version&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gazebo_launch&quot;</span><span class="p">,</span>
    <span class="s2">&quot;save_world&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spawn_model&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spawn_topic_bridges&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spawn_world_transform&quot;</span><span class="p">,</span>
    <span class="s2">&quot;get_gazebo_axes_args&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GazeboBridge&quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">get_args</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">subprocess</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_output</span><span class="p">,</span> <span class="n">STDOUT</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tempfile</span><span class="w"> </span><span class="kn">import</span> <span class="n">NamedTemporaryFile</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">ament_index_python.packages</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_package_share_directory</span><span class="p">,</span>
    <span class="n">PackageNotFoundError</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">better_launch</span><span class="w"> </span><span class="kn">import</span> <span class="n">BetterLaunch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">better_launch.elements</span><span class="w"> </span><span class="kn">import</span> <span class="n">Node</span>


<div class="viewcode-block" id="get_gazebo_version">
<a class="viewcode-back" href="../../better_launch.html#better_launch.gazebo.get_gazebo_version">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_gazebo_version</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For a short time, Gazebo rebranded to &quot;Ignition&quot; before returning to Gazebo again. This function returns the associated prefix.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The prefix indicating the type of Gazebo: &quot;ign&quot; for Ignition Gazebo or &quot;gz&quot; for Gazebo Classic.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;IGN_VERSION&quot;</span><span class="p">,</span> <span class="s2">&quot;IGNITION_VERSION&quot;</span><span class="p">,</span> <span class="s2">&quot;GZ_VERSION&quot;</span><span class="p">]:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;ign&quot;</span> <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;fortress&quot;</span> <span class="k">else</span> <span class="s2">&quot;gz&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">get_package_share_directory</span><span class="p">(</span><span class="s2">&quot;ros_gz&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;gz&quot;</span>
    <span class="k">except</span> <span class="n">PackageNotFoundError</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;ign&quot;</span></div>



<div class="viewcode-block" id="gazebo_launch">
<a class="viewcode-back" href="../../better_launch.html#better_launch.gazebo.gazebo_launch">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">gazebo_launch</span><span class="p">(</span>
    <span class="n">package</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">world_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">gz_args</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">world_save_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save_after</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Starts a Gazebo simulation with the specified world. If `world_save_file` is specified, the world will be saved as an SDF to that file after `save_after` seconds, including base world and spawned entities.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    package : str,</span>
<span class="sd">        A package to locate the world_file in. May be `None` (see :py:meth:`BetterLaunch.find`).</span>
<span class="sd">    world_file : str</span>
<span class="sd">        Path to the primary world file for the simulation.</span>
<span class="sd">    gz_args : _type_, optional</span>
<span class="sd">        Optional arguments to pass to the Gazebo simulator.</span>
<span class="sd">    world_save_file : _type_, optional</span>
<span class="sd">        Path where the resulting SDF should be saved.</span>
<span class="sd">    save_after : float, optional</span>
<span class="sd">        Time in seconds after which the world SDF should be saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bl</span> <span class="o">=</span> <span class="n">BetterLaunch</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>

    <span class="n">world_file</span> <span class="o">=</span> <span class="n">bl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">world_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">world_file</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not find world file&quot;</span><span class="p">)</span>

    <span class="n">full_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">world_file</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">gz_args</span><span class="p">:</span>
        <span class="n">full_args</span> <span class="o">+=</span> <span class="n">gz_args</span>

    <span class="n">full_args</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">full_args</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">get_gazebo_version</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;gz&quot;</span><span class="p">:</span>
        <span class="n">launch_file</span> <span class="o">=</span> <span class="n">bl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ros_gz_sim&quot;</span><span class="p">,</span> <span class="s2">&quot;gz_sim.launch.py&quot;</span><span class="p">)</span>
        <span class="n">launch_arguments</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gz_args&quot;</span><span class="p">:</span> <span class="n">full_args</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">launch_file</span> <span class="o">=</span> <span class="n">bl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ros_ign_gazebo&quot;</span><span class="p">,</span> <span class="s2">&quot;ign_gazebo.launch.py&quot;</span><span class="p">)</span>
        <span class="n">launch_arguments</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ign_args&quot;</span><span class="p">:</span> <span class="n">full_args</span><span class="p">}</span>

    <span class="n">bl</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">launch_file</span><span class="p">,</span> <span class="o">**</span><span class="n">launch_arguments</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">world_save_file</span><span class="p">:</span>
        <span class="n">save_world</span><span class="p">(</span><span class="n">world_save_file</span><span class="p">,</span> <span class="n">save_after</span><span class="p">)</span></div>



<div class="viewcode-block" id="save_world">
<a class="viewcode-back" href="../../better_launch.html#better_launch.gazebo.save_world">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">save_world</span><span class="p">(</span><span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">after</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Saves the current gazebo world to a file. Resolves any spawned URDF through their description parameter and converts to SDF.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filepath : str</span>
<span class="sd">        Path to the file to save the gazebo world to.</span>
<span class="sd">    after : float, optional</span>
<span class="sd">        How long to wait before saving.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bl</span> <span class="o">=</span> <span class="n">BetterLaunch</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">():</span>
        <span class="n">bl</span><span class="o">.</span><span class="n">node</span><span class="p">(</span>
            <span class="n">package</span><span class="o">=</span><span class="s2">&quot;better_launch&quot;</span><span class="p">,</span>
            <span class="n">executable</span><span class="o">=</span><span class="s2">&quot;generate_gz_world&quot;</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;output_path&quot;</span><span class="p">:</span> <span class="n">filepath</span><span class="p">},</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">after</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">bl</span><span class="o">.</span><span class="n">run_later</span><span class="p">(</span><span class="n">after</span><span class="p">,</span> <span class="n">save</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save</span><span class="p">()</span></div>



<div class="viewcode-block" id="spawn_model">
<a class="viewcode-back" href="../../better_launch.html#better_launch.gazebo.spawn_model">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">spawn_model</span><span class="p">(</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">topic_or_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">spawn_args</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spawns a model into Gazebo under the given name from the specified topic or file.</span>

<span class="sd">    The spawn_args dictionary can include additional options, such as the initial pose of the model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of the model to spawn in the Gazebo environment.</span>
<span class="sd">    topic_or_file : str</span>
<span class="sd">        The topic or file to retrieve the model description from. Topic is tested first.</span>
<span class="sd">    spawn_args : dict[str, Any], optional</span>
<span class="sd">        Additional arguments for spawning the model, such as pose and other options. See :py:meth:`get_gazebo_axes_args` for defining the model&#39;s orientation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Node</span>
<span class="sd">        The spawned node instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bl</span> <span class="o">=</span> <span class="n">BetterLaunch</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">spawn_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">spawn_args</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">cmd_args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-name&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="p">]</span>

    <span class="n">topics</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">bl</span><span class="o">.</span><span class="n">shared_node</span><span class="o">.</span><span class="n">get_topic_names_and_types</span><span class="p">()}</span>
    <span class="k">if</span> <span class="n">topic_or_file</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">:</span>
        <span class="n">cmd_args</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;-topic&quot;</span><span class="p">,</span> <span class="n">topic_or_file</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">topic_or_file</span><span class="p">):</span>
        <span class="n">cmd_args</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;-file&quot;</span><span class="p">,</span> <span class="n">topic_or_file</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">topic_or_file</span><span class="si">}</span><span class="s2"> is not an existing topic nor a file&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">spawn_args</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">cmd_args</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;-</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>

    <span class="n">pkg</span> <span class="o">=</span> <span class="s2">&quot;ros_ign_gazebo&quot;</span> <span class="k">if</span> <span class="n">get_gazebo_version</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ign&quot;</span> <span class="k">else</span> <span class="s2">&quot;ros_gz_sim&quot;</span>
    <span class="k">return</span> <span class="n">bl</span><span class="o">.</span><span class="n">node</span><span class="p">(</span>
        <span class="n">pkg</span><span class="p">,</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;spawn_</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">anonymous</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmd_args</span><span class="o">=</span><span class="n">cmd_args</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="spawn_topic_bridges">
<a class="viewcode-back" href="../../better_launch.html#better_launch.gazebo.spawn_topic_bridges">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">spawn_topic_bridges</span><span class="p">(</span>
    <span class="o">*</span><span class="n">bridges</span><span class="p">:</span> <span class="s2">&quot;GazeboBridge&quot;</span><span class="p">,</span> <span class="n">node_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gz_bridge&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Node</span><span class="p">,</span> <span class="n">Node</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a `ros_gz_bridge::parameter_bridge` node with the specified `GazeboBridge` instances.</span>

<span class="sd">    This function sets up ROS-Gazebo bridges for different topic types. Standard topic bridges (non-image) are configured via a YAML parameter file, while image topics are handled separately through remappings.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *bridges : GazeboBridge</span>
<span class="sd">        One or more `GazeboBridge` instances defining the Gazebo-ROS topic bridges.</span>
<span class="sd">    node_name : str, optional</span>
<span class="sd">        Name of the bridge node, by default `&quot;gz_bridge&quot;`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple[Node, Node]</span>
<span class="sd">        The up to two nodes that will be started by this function. The first node will be the node handling all regular topic bridges, the second the one for the image topics. Either of these may be `None`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bridges</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">bl</span> <span class="o">=</span> <span class="n">BetterLaunch</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>

    <span class="n">ros_gz</span> <span class="o">=</span> <span class="s2">&quot;ros_&quot;</span> <span class="o">+</span> <span class="n">get_gazebo_version</span><span class="p">()</span>
    <span class="n">image_bridges</span> <span class="o">=</span> <span class="p">[</span><span class="n">bridge</span> <span class="k">for</span> <span class="n">bridge</span> <span class="ow">in</span> <span class="n">bridges</span> <span class="k">if</span> <span class="n">bridge</span><span class="o">.</span><span class="n">is_image</span><span class="p">]</span>
    <span class="n">std_config</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bridge</span><span class="o">.</span><span class="n">yaml</span><span class="p">()</span> <span class="k">for</span> <span class="n">bridge</span> <span class="ow">in</span> <span class="n">bridges</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">bridge</span><span class="o">.</span><span class="n">is_image</span><span class="p">)</span>

    <span class="n">node_reg</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">node_img</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">std_config</span><span class="p">:</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="n">NamedTemporaryFile</span><span class="p">()</span><span class="o">.</span><span class="n">name</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">std_config</span><span class="p">)</span>

        <span class="n">node_reg</span> <span class="o">=</span> <span class="n">bl</span><span class="o">.</span><span class="n">node</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ros_gz</span><span class="si">}</span><span class="s2">_bridge&quot;</span><span class="p">,</span>
            <span class="s2">&quot;parameter_bridge&quot;</span><span class="p">,</span>
            <span class="n">node_name</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;config_file&quot;</span><span class="p">:</span> <span class="n">dst</span><span class="p">},</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">image_bridges</span><span class="p">:</span>
        <span class="n">img_remaps</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">bridge</span> <span class="ow">in</span> <span class="n">image_bridges</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;/compressed&quot;</span><span class="p">,</span> <span class="s2">&quot;/compressedDepth&quot;</span><span class="p">,</span> <span class="s2">&quot;/theora&quot;</span><span class="p">):</span>
                <span class="n">remapped_gz_topic</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bridge</span><span class="o">.</span><span class="n">gz_topic</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">remapped_ros_topic</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bridge</span><span class="o">.</span><span class="n">ros_topic</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">img_remaps</span><span class="p">[</span><span class="n">remapped_gz_topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">remapped_ros_topic</span>

        <span class="n">node_img</span> <span class="o">=</span> <span class="n">bl</span><span class="o">.</span><span class="n">node</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ros_gz</span><span class="si">}</span><span class="s2">_image&quot;</span><span class="p">,</span>
            <span class="s2">&quot;image_bridge&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node_name</span><span class="si">}</span><span class="s2">_image&quot;</span><span class="p">,</span>
            <span class="n">remaps</span><span class="o">=</span><span class="n">img_remaps</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">node_reg</span><span class="p">,</span> <span class="n">node_img</span><span class="p">)</span></div>



<div class="viewcode-block" id="spawn_world_transform">
<a class="viewcode-back" href="../../better_launch.html#better_launch.gazebo.spawn_world_transform">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">spawn_world_transform</span><span class="p">(</span><span class="n">gazebo_world_frame</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs a static_transform_publisher to connect the ROS `world` frame and a Gazebo world frame, if the Gazebo world frame is specified and different from &#39;world&#39;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gazebo_world_frame : str, optional</span>
<span class="sd">        The name of the Gazebo world frame. If None, retrieves the default from :py:meth:`GazeboBridge.world`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Node</span>
<span class="sd">        The spawned node instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">gazebo_world_frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gazebo_world_frame</span> <span class="o">=</span> <span class="n">GazeboBridge</span><span class="o">.</span><span class="n">world</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">gazebo_world_frame</span> <span class="o">!=</span> <span class="s2">&quot;world&quot;</span><span class="p">:</span>
        <span class="n">bl</span> <span class="o">=</span> <span class="n">BetterLaunch</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">bl</span><span class="o">.</span><span class="n">node</span><span class="p">(</span>
            <span class="s2">&quot;tf2_ros&quot;</span><span class="p">,</span>
            <span class="s2">&quot;static_transform_publisher&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gazebo_world_tf&quot;</span><span class="p">,</span>
            <span class="n">cmd_args</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;--frame-id&quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">,</span> <span class="s2">&quot;--child-frame-id&quot;</span><span class="p">,</span> <span class="n">gazebo_world_frame</span><span class="p">],</span>
            <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="get_gazebo_axes_args">
<a class="viewcode-back" href="../../better_launch.html#better_launch.gazebo.get_gazebo_axes_args">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_gazebo_axes_args</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">z</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">yaw</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">pitch</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">roll</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructs a list of command-line arguments that can be used e.g. when spawning a new model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : float, optional</span>
<span class="sd">        translation x component</span>
<span class="sd">    y : float, optional</span>
<span class="sd">        translation y component</span>
<span class="sd">    z : float, optional</span>
<span class="sd">        translation z component</span>
<span class="sd">    yaw : float, optional</span>
<span class="sd">        rotation yaw component</span>
<span class="sd">    pitch : float, optional</span>
<span class="sd">        rotation pitch component</span>
<span class="sd">    roll : float, optional</span>
<span class="sd">        rotation roll component</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict[str, float]</span>
<span class="sd">        A dictionary containing the axes names and values. The axes names correspond to what Gazebo expects on the command line and so can be passed to e.g. :py:meth:`gazebo_spawn_model`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span>
        <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span>
        <span class="s2">&quot;Y&quot;</span><span class="p">:</span> <span class="n">yaw</span><span class="p">,</span>
        <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="n">pitch</span><span class="p">,</span>
        <span class="s2">&quot;R&quot;</span><span class="p">:</span> <span class="n">roll</span><span class="p">,</span>
    <span class="p">}</span></div>



<div class="viewcode-block" id="GazeboBridge">
<a class="viewcode-back" href="../../better_launch.html#better_launch.gazebo.GazeboBridge">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GazeboBridge</span><span class="p">:</span>
    <span class="n">Direction</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;gz2ros&quot;</span><span class="p">,</span> <span class="s2">&quot;ros2gz&quot;</span><span class="p">,</span> <span class="s2">&quot;bidirectional&quot;</span><span class="p">]</span>

    <span class="n">_active_world_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_gz_exec</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># ros &lt;-&gt; gz mapping</span>
    <span class="c1"># from https://github.com/gazebosim/ros_gz/tree/ros2/ros_gz_bridge</span>
    <span class="c1">#</span>
    <span class="c1"># def generate_msg_map(readme) -&gt; None:</span>
    <span class="c1">#     out = [&quot;    msg_map = {&quot;]</span>
    <span class="c1">#</span>
    <span class="c1">#     for line in readme.splitlines():</span>
    <span class="c1">#         if &quot;|&quot; in line and &quot;/msg/&quot; in line and &quot;gz.msgs&quot; in line:</span>
    <span class="c1">#             _, ros, gz, _ = line.split(&quot;|&quot;)</span>
    <span class="c1">#             out.append(f&quot;    &#39;{ros.strip()}&#39;: &#39;{gz.strip()}&#39;,&quot;)</span>
    <span class="c1">#     print(&quot;\n&quot;.join(out)[:-1] + &quot;}&quot;)</span>

    <span class="n">msg_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;actuator_msgs/msg/Actuators&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Actuators&quot;</span><span class="p">,</span>
        <span class="s2">&quot;builtin_interfaces/msg/Time&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry_msgs/msg/Point&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Vector3d&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry_msgs/msg/Pose&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Pose&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry_msgs/msg/PoseArray&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Pose_V&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry_msgs/msg/PoseStamped&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Pose&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry_msgs/msg/PoseWithCovariance&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.PoseWithCovariance&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry_msgs/msg/PoseWithCovarianceStamped&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.PoseWithCovariance&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry_msgs/msg/Quaternion&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Quaternion&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry_msgs/msg/Transform&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Pose&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry_msgs/msg/TransformStamped&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Pose&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry_msgs/msg/Twist&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Twist&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry_msgs/msg/TwistStamped&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Twist&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry_msgs/msg/TwistWithCovariance&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.TwistWithCovariance&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry_msgs/msg/TwistWithCovarianceStamped&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.TwistWithCovariance&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry_msgs/msg/Vector3&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Vector3d&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry_msgs/msg/Wrench&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Wrench&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry_msgs/msg/WrenchStamped&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Wrench&quot;</span><span class="p">,</span>
        <span class="s2">&quot;gps_msgs/msg/GPSFix&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.NavSat&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nav_msgs/msg/Odometry&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.OdometryWithCovariance&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rcl_interfaces/msg/ParameterValue&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Any&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ros_gz_interfaces/msg/Altimeter&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Altimeter&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ros_gz_interfaces/msg/Contact&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Contact&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ros_gz_interfaces/msg/Contacts&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Contacts&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ros_gz_interfaces/msg/Dataframe&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Dataframe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ros_gz_interfaces/msg/Entity&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Entity&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ros_gz_interfaces/msg/Float32Array&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Float_V&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ros_gz_interfaces/msg/GuiCamera&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.GUICamera&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ros_gz_interfaces/msg/JointWrench&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.JointWrench&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ros_gz_interfaces/msg/Light&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Light&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ros_gz_interfaces/msg/ParamVec&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Param&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ros_gz_interfaces/msg/SensorNoise&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.SensorNoise&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ros_gz_interfaces/msg/StringVec&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.StringMsg_V&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ros_gz_interfaces/msg/TrackVisual&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.TrackVisual&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ros_gz_interfaces/msg/VideoRecord&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.VideoRecord&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rosgraph_msgs/msg/Clock&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Clock&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sensor_msgs/msg/BatteryState&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.BatteryState&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sensor_msgs/msg/CameraInfo&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.CameraInfo&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sensor_msgs/msg/FluidPressure&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.FluidPressure&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sensor_msgs/msg/Image&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Image&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sensor_msgs/msg/Imu&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.IMU&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sensor_msgs/msg/JointState&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Model&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sensor_msgs/msg/Joy&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Joy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sensor_msgs/msg/LaserScan&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.LaserScan&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sensor_msgs/msg/MagneticField&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Magnetometer&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sensor_msgs/msg/NavSatFix&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.NavSat&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sensor_msgs/msg/PointCloud2&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.PointCloudPacked&quot;</span><span class="p">,</span>
        <span class="s2">&quot;std_msgs/msg/Bool&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Boolean&quot;</span><span class="p">,</span>
        <span class="s2">&quot;std_msgs/msg/ColorRGBA&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Color&quot;</span><span class="p">,</span>
        <span class="s2">&quot;std_msgs/msg/Empty&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Empty&quot;</span><span class="p">,</span>
        <span class="s2">&quot;std_msgs/msg/Float32&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Float&quot;</span><span class="p">,</span>
        <span class="s2">&quot;std_msgs/msg/Float64&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Double&quot;</span><span class="p">,</span>
        <span class="s2">&quot;std_msgs/msg/Header&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Header&quot;</span><span class="p">,</span>
        <span class="s2">&quot;std_msgs/msg/Int32&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Int32&quot;</span><span class="p">,</span>
        <span class="s2">&quot;std_msgs/msg/String&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.StringMsg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;std_msgs/msg/UInt32&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.UInt32&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tf2_msgs/msg/TFMessage&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.Pose_V&quot;</span><span class="p">,</span>
        <span class="s2">&quot;trajectory_msgs/msg/JointTrajectory&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.JointTrajectory&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vision_msgs/msg/Detection2D&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.AnnotatedAxisAligned2DBox&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vision_msgs/msg/Detection2DArray&quot;</span><span class="p">:</span> <span class="s2">&quot;gz.msgs.AnnotatedAxisAligned2DBox_V&quot;</span><span class="p">,</span>
    <span class="p">}</span>

<div class="viewcode-block" id="GazeboBridge.__init__">
<a class="viewcode-back" href="../../better_launch.html#better_launch.gazebo.GazeboBridge.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">gz_topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ros_topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ros_msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">direction</span><span class="p">:</span> <span class="n">Direction</span><span class="p">,</span>
        <span class="n">gz_msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a ROS-to-Gazebo bridge with the specified parameters.</span>

<span class="sd">        This constructor sets up the bridge between a ROS topic and a Gazebo topic. It maps the ROS message type to a Gazebo message type and validates the direction of communication (i.e. ROS to Gazebo, Gazebo to ROS, or bidirectional).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gz_topic : str</span>
<span class="sd">            The Gazebo topic to be bridged.</span>
<span class="sd">        ros_topic : str</span>
<span class="sd">            The ROS topic to be bridged.</span>
<span class="sd">        ros_msg : str</span>
<span class="sd">            The message type used on the ROS topic.</span>
<span class="sd">        direction : Direction</span>
<span class="sd">            The direction of the bridge.</span>
<span class="sd">        gz_msg : str, optional</span>
<span class="sd">            The Gazebo message type. If not provided, it will be inferred from the ROS message type.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the provided message type or direction is invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;/msg/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ros_msg</span><span class="p">:</span>
            <span class="n">ros_msg</span> <span class="o">=</span> <span class="n">ros_msg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;/msg/&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">gz_msg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gz_msg</span> <span class="o">=</span> <span class="n">gz_msg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ros_msg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_map</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Unknown message type &#39;</span><span class="si">{</span><span class="n">ros_msg</span><span class="si">}</span><span class="s2">&#39;, try giving an explicit gz_msg&quot;</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">gz_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_map</span><span class="p">[</span><span class="n">ros_msg</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">direction</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">get_args</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Direction</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid bridge direction &#39;</span><span class="si">{</span><span class="n">direction</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gz_topic</span> <span class="o">=</span> <span class="n">gz_topic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ros_topic</span> <span class="o">=</span> <span class="n">ros_topic</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_image</span> <span class="o">=</span> <span class="n">ros_msg</span> <span class="o">==</span> <span class="s2">&quot;sensor_msgs/msg/Image&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ros_msg</span> <span class="o">=</span> <span class="n">ros_msg</span></div>


<div class="viewcode-block" id="GazeboBridge.gz_exec">
<a class="viewcode-back" href="../../better_launch.html#better_launch.gazebo.GazeboBridge.gz_exec">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">gz_exec</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_gz_exec</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_gz_exec</span> <span class="o">=</span> <span class="n">get_gazebo_version</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_gz_exec</span></div>


<div class="viewcode-block" id="GazeboBridge.yaml">
<a class="viewcode-back" href="../../better_launch.html#better_launch.gazebo.GazeboBridge.yaml">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a YAML snippet that can be used to configure other bridges.&quot;&quot;&quot;</span>
        <span class="n">gz_exec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gz_exec</span><span class="p">()</span>

        <span class="n">dir_string</span> <span class="o">=</span> <span class="s2">&quot;BIDIRECTIONAL&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;gz2ros&quot;</span><span class="p">:</span>
            <span class="n">dir_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gz_exec</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">_TO_ROS&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;ros2gz&quot;</span><span class="p">:</span>
            <span class="n">dir_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ROS_TO_</span><span class="si">{</span><span class="n">gz_exec</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">gz_exec</span> <span class="o">==</span> <span class="s2">&quot;ign&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gz_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gz_msg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;gz.&quot;</span><span class="p">,</span> <span class="s2">&quot;ignition.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">- </span><span class="si">{</span><span class="n">gz_exec</span><span class="si">}</span><span class="s2">_topic_name: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gz_topic</span><span class="si">}</span>
<span class="s2">  </span><span class="si">{</span><span class="n">gz_exec</span><span class="si">}</span><span class="s2">_type_name: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gz_msg</span><span class="si">}</span>
<span class="s2">  ros_topic_name: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ros_topic</span><span class="si">}</span>
<span class="s2">  ros_type_name: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ros_msg</span><span class="si">}</span>
<span class="s2">  direction: </span><span class="si">{</span><span class="n">dir_string</span><span class="si">}</span>
<span class="s2">&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="GazeboBridge.set_world_name">
<a class="viewcode-back" href="../../better_launch.html#better_launch.gazebo.GazeboBridge.set_world_name">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_world_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Overwrite world name in order to avoid communicating with Gazebo</span>
<span class="sd">        Useful when Gazebo is launched in an included file, where the world name cannot be guessed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">GazeboBridge</span><span class="o">.</span><span class="n">_active_world_name</span> <span class="o">=</span> <span class="n">name</span></div>


<div class="viewcode-block" id="GazeboBridge.world">
<a class="viewcode-back" href="../../better_launch.html#better_launch.gazebo.GazeboBridge.world">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">world</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the name of the currently loaded world. If it was not loaded from better_launch, Gazebo will be asked directly.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The name of a Gazebo world.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If querying Gazebo for the world name failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">GazeboBridge</span><span class="o">.</span><span class="n">_active_world_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GazeboBridge</span><span class="o">.</span><span class="n">_active_world_name</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">gz_exec</span><span class="p">(),</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;--list&quot;</span><span class="p">]</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">STDOUT</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to list loaded Gazebo models: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span> <span class="ow">or</span> <span class="s2">&quot;timed out&quot;</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No loaded Gazebo models or request timed out&quot;</span><span class="p">)</span>

        <span class="n">world_name</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="s2">&quot;[&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">world_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The command </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="si">}</span><span class="s2"> did not return a parseable world name (output was &#39;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
            <span class="p">)</span>

        <span class="n">GazeboBridge</span><span class="o">.</span><span class="n">_active_world_name</span> <span class="o">=</span> <span class="n">world_name</span>
        <span class="k">return</span> <span class="n">world_name</span></div>


<div class="viewcode-block" id="GazeboBridge.get_model_path">
<a class="viewcode-back" href="../../better_launch.html#better_launch.gazebo.GazeboBridge.get_model_path">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_model_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructs a Gazebo model prefix string for the given model name.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : str</span>
<span class="sd">            The name of the model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            A string representing the model&#39;s prefix in the Gazebo world.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;/world/</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">world</span><span class="p">()</span><span class="si">}</span><span class="s2">/model/</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span></div>


<div class="viewcode-block" id="GazeboBridge.get_model_topic">
<a class="viewcode-back" href="../../better_launch.html#better_launch.gazebo.GazeboBridge.get_model_topic">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_model_topic</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructs a tuple representing the model topic in Gazebo.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : str</span>
<span class="sd">            The model name.</span>
<span class="sd">        topic : str</span>
<span class="sd">            The topic name related to the model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The path of the given model&#39;s specified topic.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># NOTE simple_launch only returns f&quot;/model/{model}/{topic}&quot;, but that seems wrong</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_model_path</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">&quot;</span></div>


<div class="viewcode-block" id="GazeboBridge.make_clock_bridge">
<a class="viewcode-back" href="../../better_launch.html#better_launch.gazebo.GazeboBridge.make_clock_bridge">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_clock_bridge</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GazeboBridge&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a GazeboBridge instance for the /clock topic.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        GazeboBridge</span>
<span class="sd">            An instance of the GazeboBridge for the clock topic.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GazeboBridge</span><span class="p">(</span><span class="s2">&quot;/clock&quot;</span><span class="p">,</span> <span class="s2">&quot;/clock&quot;</span><span class="p">,</span> <span class="s2">&quot;rosgraph_msgs/msg/Clock&quot;</span><span class="p">,</span> <span class="s2">&quot;gz2ros&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="GazeboBridge.make_joint_state_bridge">
<a class="viewcode-back" href="../../better_launch.html#better_launch.gazebo.GazeboBridge.make_joint_state_bridge">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_joint_state_bridge</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GazeboBridge&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a GazeboBridge instance for the joint states of a given model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : str</span>
<span class="sd">            The model name to associate with the joint state topic.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        GazeboBridge</span>
<span class="sd">            An instance of the GazeboBridge for the joint state topic.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">js_gz_topic</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/world/</span><span class="si">{</span><span class="n">GazeboBridge</span><span class="o">.</span><span class="n">world</span><span class="p">()</span><span class="si">}</span><span class="s2">/model/</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">/joint_state&quot;</span>
        <span class="k">return</span> <span class="n">GazeboBridge</span><span class="p">(</span>
            <span class="n">js_gz_topic</span><span class="p">,</span> <span class="s2">&quot;joint_states&quot;</span><span class="p">,</span> <span class="s2">&quot;sensor_msgs/JointState&quot;</span><span class="p">,</span> <span class="s2">&quot;gz2ros&quot;</span>
        <span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Nikolas Dahn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>